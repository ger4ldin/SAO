<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
        </script>
    <link rel="stylesheet" href="../src/css/style.css">
    <title>Comprar</title>
</head>

<body>
    <header class="py-3 border-bottom">
        <div class="container-fluid row align-items-center">
            <div class="dropdown col-12 col-lg-3 col-md-3">
                <a href="../html/index.html"
                    class="d-flex align-items-center col-lg-4 mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
                    <img src="../src/img/wallpaper/logo.png" alt="logo-Sao" class="d-block " width="100" height="40"
                        style="margin: 0 auto;">
                </a>
            </div>
            <div class="d-flex align-items-center d-grid gap-2 align-items-center col-12 col-lg-9 col-md-9"
                style="grid-template-columns: 95% 1fr;">
                <!-- Search -->
                <form class="w-100 me-3" role="search">
                    <div class="input-group ">
                        <span class="input-group-text" id="basic-addon1"
                            style="background-color: #fe6347;color: white;">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512"
                                height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z">
                                </path>
                            </svg>
                        </span>
                        <input type="text" class="form-control input" placeholder="¿Que desea encontrar?"
                            aria-label="Username" aria-describedby="basic-addon1">
                    </div>
                </form>

                <div class="flex-shrink-0 dropdown">
                    <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle fs-2"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                            width="1em" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 4H21V6H3V4ZM9 11H21V13H9V11ZM3 18H21V20H3V18Z"></path>
                        </svg>
                    </a>
                    <ul class="dropdown-menu text-small shadow">
                        <li><a class="dropdown-item mb-2 py-2 " href="../html/principalUser.html">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89zm-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5l1.93-.01zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31V5zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41a1.42 1.42 0 0 1-.33-1.07zm-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17zM5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19H5z"></path></svg>
                                <span class="container">Tienda</span>
                            </a></li>
                        <li><a class="dropdown-item mb-2 py-2 " href="../html/cuenta.html">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"></path></svg>
                                <span class="container">Mi cuenta</span>
                            </a></li>
                        <!--<li><a class="dropdown-item mb-2 py-2 " href="../html/listaDeseos.html">
                                <svg class="fs-3" stroke="currentColor" fill="currentColor" stroke-width="0"
                                    viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z">
                                    </path>
                                </svg>
                                <span class="container">Lista de Deseos</span>
                            </a></li>-->
                        <li><a class="dropdown-item mb-2 py-2 " href="../html/carritoDeCompra.html">
                            <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                                <span class="container">Carrito</span>
                            </a></li>
                        <li><a class="dropdown-item mb-2 py-2 " href="../html/pedidos.html">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10.5 3.5a2.5 2.5 0 0 0-5 0V4h5v-.5Zm1 0V4H15v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4h3.5v-.5a3.5 3.5 0 1 1 7 0ZM14 14V5H2v9a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1ZM8 7.993c1.664-1.711 5.825 1.283 0 5.132-5.825-3.85-1.664-6.843 0-5.132Z"></path></svg>
                                <span class="container">Pedidos</span>
                            </a></li>        
                        <li><a class="dropdown-item mb-2 py-2 " href="../html/index.html">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1.1" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M10 2.29v2.124c0.566 0.247 1.086 0.6 1.536 1.050 0.944 0.944 1.464 2.2 1.464 3.536s-0.52 2.591-1.464 3.536c-0.944 0.944-2.2 1.464-3.536 1.464s-2.591-0.52-3.536-1.464c-0.944-0.944-1.464-2.2-1.464-3.536s0.52-2.591 1.464-3.536c0.45-0.45 0.97-0.803 1.536-1.050v-2.124c-2.891 0.861-5 3.539-5 6.71 0 3.866 3.134 7 7 7s7-3.134 7-7c0-3.171-2.109-5.849-5-6.71zM7 0h2v8h-2z"></path></svg>
                                <span class="container">Cerrar sesión</span>
                            </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <div class="container mb-2 mt-5">
        <form class="row" id="pagar">
            <h5>Carrito:</h5>
            <div class="container-fluid col-12 mb-1 row">
                <div class="container-fluid col-12 col-md-6 col-lg-4 mb-3" id="productos">
                    
                </div>
            </div>
            <div class="container shadow-sm rounded-4 py-3 px-5 mb-5">
                <p>Su total es de:<b class="d-block fs-5" id="total">$5713.00</b></p>
            </div>
            <div class="container col-12 mb-2" style="max-width: 700px;">
                <div class="container-fluid mt-3">
                    <h5>Datos de direccion: </h5>
                    <div class="row mt-2">
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Pais<small
                                    style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><select
                                name="inputBuyCountry" class="form-control" required="">
                                <option value="1">Mexico</option>
                            </select></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Estado:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" required=""
                                name="inputBuyState" placeholder=""></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Localidad:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" required=""
                                name="inputBuylocality" placeholder=""></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Calle principal:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" required=""
                                name="inputBuyMainStreet" placeholder=""></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Calle 1:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;"></small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" name="inputBuyStreet1"
                                placeholder=""></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Calle 2:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;"></small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" name="inputBuyStreet2"
                                placeholder=""></div>
                        <div class="container-fluid col-12 mb-2"><label for="">Referencias:</label><input
                                class="form-control" maxlength="50" type="text" minlength="1" name="inputBuyReferences"
                                placeholder=""></div>
                    </div>
                </div>
                <div class="container-fluid mt-3">
                    <h5>Opciones de pago: </h5>
                    <div class="row mt-2">
                        <div class="container-fluid col-12 row gap-4 mb-5">
                            <div class="col-12 ">
                                <h6>Metodo de pago:</h6>
                            </div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault0"><img src="https://xihmai.com/api/assets/brands/vs.png"
                                        alt="visa" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault0"
                                    style="width: 25px; height: 25px;"></div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault1"><img src="https://xihmai.com/api/assets/brands/mc.png"
                                        alt="mastercard" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault1"
                                    style="width: 25px; height: 25px;"></div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault2"><img src="https://xihmai.com/api/assets/brands/oxxo.png"
                                        alt="oxxo" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault2"
                                    style="width: 25px; height: 25px;"></div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault3"><img src="https://xihmai.com/api/assets/brands/mp.png"
                                        alt="mercado pago" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault3"
                                    style="width: 25px; height: 25px;"></div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault4"><img src="https://xihmai.com/api/assets/brands/pp.png"
                                        alt="paypal" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault4"
                                    style="width: 25px; height: 25px;"></div>
                        </div>
                        <div class="container-fluid col-12 mb-2">
                            <div class="container-fluid mb-3"><label for="">Nombre del titular<small
                                        style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                    class="form-control" maxlength="50" type="text" minlength="1" required=""
                                    name="inputBuyTitular"></div>
                        </div>
                        <div class="container-fluid col-12 mb-2">
                            <div class="container-fluid mb-3"><label for="">Numero de tarjeta<small
                                        style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                    class="form-control" maxlength="16" type="tel" minlength="16" required=""
                                    name="inputBuyNumberCard"></div>
                        </div>
                        <div class="container-fluid col-12 mb-2 row">
                            <div class="container-fluid col-7">
                                <div class="container-fluid mb-3"><label for="">Fecha de expiracion<small
                                            style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                        class="form-control" maxlength="7" type="text" minlength="4" required=""
                                        name="inputBuyExpiration" placeholder="MM / YYYY"></div>
                            </div>
                            <div class="container-fluid col-5">
                                <div class="container-fluid mb-3"><label for="">CVV<small
                                            style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                        class="form-control" maxlength="3" type="number" minlength="3" required=""
                                        name="inputBuyCVV"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="buttonSao"><button type="submit" class="btn btn-danger rounded-4 ">Pagar</button></div>
        </form>
    </div>
    <script>
        const componenteDelProducto = (data)=>{
            const productos = document.getElementById("productos")
            const total = document.getElementById("total")
            total.innerHTML="";
            productos.innerHTML="";
            var sumador=0;
            data.map(d =>{
                sumador+=d.quantity*d.price;
                productos.innerHTML +=`
                <div class="container shadow-sm rounded-3 row p-2 mx-auto">
                    <div class="col-4">
                        <img
                            src="http://localhost/SAO/php/products${d.imagen}"
                            alt="${d.name}">
                        </div>
                    <div class="col-8 pl-2">
                        <h5>${d.name}</h5>
                        <p>${d.description}</p>
                        <span>${d.quantity} x ${d.price} = <b>$${d.quantity*d.price} MX
                            </b></span>
                    </div>
                </div>
                `
            })
            total.innerHTML = `$${sumador} MX`
        }

        const traerProductosDelCarrito = async ()=>{
            const body = new FormData();
            body.append("id_user", localStorage.getItem("iduser"));
            await fetch("../php/cart/get.php",{
                method: "POST",
                body:body,
            })
            .then(response => response.json())
            .then(res =>{
                if(res.success){
                    componenteDelProducto(res.data)
                } else{
                    alert("erorr")
                    console.log(res)
                    console.log(data)
                }
                // code
            })
            .catch(error => console.log(error));
        }
        
        const pagar = document.getElementById("pagar");

        const enviar = async ()=>{
            const {
                inputBuyCountry,
                inputBuyState,
                inputBuylocality,
                inputBuyMainStreet,
                inputBuyStreet1,
                inputBuyStreet2,
                inputBuyReferences,
       
                inputBuyPM,
                inputBuyTitular,
                inputBuyNumberCard,
                inputBuyExpiration,
                inputBuyCVV,
             } = pagar
             const data = new FormData()
             data.append("id_user",localStorage.getItem("iduser"))
             data.append("inputBuyCountry",inputBuyCountry.value)
             data.append("inputBuyState",inputBuyState.value)
             data.append("inputBuylocality",inputBuylocality.value)
             data.append("inputBuyMainStreet",inputBuyMainStreet.value)
             data.append("inputBuyStreet1",inputBuyStreet1.value)
             data.append("inputBuyStreet2",inputBuyStreet2.value)
             data.append("inputBuyReferences",inputBuyReferences.value)
             data.append("inputBuyPM","1")
             data.append("inputBuyTitular",inputBuyTitular.value)
             data.append("inputBuyNumberCard",inputBuyNumberCard.value)
             data.append("inputBuyExpiration",inputBuyExpiration.value)
             data.append("inputBuyCVV",inputBuyCVV.value)
 
             await fetch("../php/buy/add.php",{
                 method: "POST",
                 body: data,
              })
              .then(response => response.json())
              .then(json => {
                 if(json.success) {
                    alert(json.data)
                    return
                 }
              })
              .catch(err => console.log(err))
        }

        pagar.addEventListener("submit", e=>{
            e.preventDefault();
            enviar()
        })

        traerProductosDelCarrito();

    </script>
</body>

</html>