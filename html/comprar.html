<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
        </script>
    <link rel="stylesheet" href="../src/css/style.css">
    <title>Document</title>
</head>

<body>
    <div class="container mb-2 mt-5">
        <form class="row" id="pagar">
            <h5>Carrito:</h5>
            <div class="container-fluid col-12 mb-1 row">
                <div class="container-fluid col-12 col-md-6 col-lg-4 mb-3" id="productos">
                    
                </div>
            </div>
            <div class="container shadow-sm rounded-4 py-3 px-5 mb-5">
                <p>Su total es de:<b class="d-block fs-5" id="total">$5713.00</b></p>
            </div>
            <div class="container col-12 mb-2" style="max-width: 700px;">
                <div class="container-fluid mt-3">
                    <h5>Datos de direccion: </h5>
                    <div class="row mt-2">
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Pais<small
                                    style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><select
                                name="inputBuyCountry" class="form-control" required="">
                                <option value="1">Mexico</option>
                            </select></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Estado:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" required=""
                                name="inputBuyState" placeholder=""></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Localidad:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" required=""
                                name="inputBuylocality" placeholder=""></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Calle principal:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" required=""
                                name="inputBuyMainStreet" placeholder=""></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Calle 1:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;"></small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" name="inputBuyStreet1"
                                placeholder=""></div>
                        <div class="container-fluid col-12 col-md-6 col-lg-4 mb-2"><label for="">Calle 2:<small
                                    style="font-size: 20px; margin-left: 3px; color: red;"></small></label><input
                                class="form-control" maxlength="100" type="text" minlength="1" name="inputBuyStreet2"
                                placeholder=""></div>
                        <div class="container-fluid col-12 mb-2"><label for="">Referencias:</label><input
                                class="form-control" maxlength="50" type="text" minlength="1" name="inputBuyReferences"
                                placeholder=""></div>
                    </div>
                </div>
                <div class="container-fluid mt-3">
                    <h5>Opciones de pago: </h5>
                    <div class="row mt-2">
                        <div class="container-fluid col-12 row gap-4 mb-5">
                            <div class="col-12 ">
                                <h6>Metodo de pago:</h6>
                            </div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault0"><img src="https://xihmai.com/api/assets/brands/vs.png"
                                        alt="visa" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault0"
                                    style="width: 25px; height: 25px;"></div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault1"><img src="https://xihmai.com/api/assets/brands/mc.png"
                                        alt="mastercard" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault1"
                                    style="width: 25px; height: 25px;"></div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault2"><img src="https://xihmai.com/api/assets/brands/oxxo.png"
                                        alt="oxxo" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault2"
                                    style="width: 25px; height: 25px;"></div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault3"><img src="https://xihmai.com/api/assets/brands/mp.png"
                                        alt="mercado pago" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault3"
                                    style="width: 25px; height: 25px;"></div>
                            <div class="col"
                                style="display: flex; justify-content: center; align-items: center; gap: 5px;"><label
                                    for="flexRadioDefault4"><img src="https://xihmai.com/api/assets/brands/pp.png"
                                        alt="paypal" style="width: 100px; height: 50px;"></label><input
                                    class="form-check-input" type="radio" name="inputBuyPM" id="flexRadioDefault4"
                                    style="width: 25px; height: 25px;"></div>
                        </div>
                        <div class="container-fluid col-12 mb-2">
                            <div class="container-fluid mb-3"><label for="">Nombre del titular<small
                                        style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                    class="form-control" maxlength="50" type="text" minlength="1" required=""
                                    name="inputBuyTitular"></div>
                        </div>
                        <div class="container-fluid col-12 mb-2">
                            <div class="container-fluid mb-3"><label for="">Numero de tarjeta<small
                                        style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                    class="form-control" maxlength="16" type="tel" minlength="16" required=""
                                    name="inputBuyNumberCard"></div>
                        </div>
                        <div class="container-fluid col-12 mb-2 row">
                            <div class="container-fluid col-7">
                                <div class="container-fluid mb-3"><label for="">Fecha de expiracion<small
                                            style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                        class="form-control" maxlength="7" type="text" minlength="4" required=""
                                        name="inputBuyExpiration" placeholder="MM / YYYY"></div>
                            </div>
                            <div class="container-fluid col-5">
                                <div class="container-fluid mb-3"><label for="">CVV<small
                                            style="font-size: 20px; margin-left: 3px; color: red;">*</small></label><input
                                        class="form-control" maxlength="3" type="number" minlength="3" required=""
                                        name="inputBuyCVV"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="buttonSao"><button type="submit" class="btn btn-danger rounded-4 ">Pagar</button></div>
        </form>
    </div>
    <script>
        const componenteDelProducto = (data)=>{
            const productos = document.getElementById("productos")
            const total = document.getElementById("total")
            total.innerHTML="";
            productos.innerHTML="";
            var sumador=0;
            data.map(d =>{
                sumador+=d.quantity*d.price;
                productos.innerHTML +=`
                <div class="container shadow-sm rounded-3 row p-2 mx-auto">
                    <div class="col-4">
                        <img
                            src="http://localhost/geral/SAO/php/products${d.imagen}"
                            alt="${d.name}">
                        </div>
                    <div class="col-8 pl-2">
                        <h5>${d.name}</h5>
                        <p>${d.description}</p>
                        <span>${d.quantity} x ${d.price} = <b>$${d.quantity*d.price} MX
                            </b></span>
                    </div>
                </div>
                `
            })
            total.innerHTML = `$${sumador} MX`
        }

        const traerProductosDelCarrito = async ()=>{
            const body = new FormData();
            body.append("id_user", localStorage.getItem("iduser"));
            await fetch("../php/cart/get.php",{
                method: "POST",
                body:body,
            })
            .then(response => response.json())
            .then(res =>{
                if(res.success){
                    componenteDelProducto(res.data)
                } else{
                    alert("erorr")
                    console.log(res)
                    console.log(data)
                }
                // code
            })
            .catch(error => console.log(error));
        }
        
        const pagar = document.getElementById("pagar");

        const enviar = async ()=>{
            const {
                inputBuyCountry,
                inputBuyState,
                inputBuylocality,
                inputBuyMainStreet,
                inputBuyStreet1,
                inputBuyStreet2,
                inputBuyReferences,
       
                inputBuyPM,
                inputBuyTitular,
                inputBuyNumberCard,
                inputBuyExpiration,
                inputBuyCVV,
             } = pagar
             const data = new FormData()
             data.append("id_user",localStorage.getItem("iduser"))
             data.append("inputBuyCountry",inputBuyCountry.value)
             data.append("inputBuyState",inputBuyState.value)
             data.append("inputBuylocality",inputBuylocality.value)
             data.append("inputBuyMainStreet",inputBuyMainStreet.value)
             data.append("inputBuyStreet1",inputBuyStreet1.value)
             data.append("inputBuyStreet2",inputBuyStreet2.value)
             data.append("inputBuyReferences",inputBuyReferences.value)
             data.append("inputBuyPM","1")
             data.append("inputBuyTitular",inputBuyTitular.value)
             data.append("inputBuyNumberCard",inputBuyNumberCard.value)
             data.append("inputBuyExpiration",inputBuyExpiration.value)
             data.append("inputBuyCVV",inputBuyCVV.value)
 
             await fetch("../php/buy/add.php",{
                 method: "POST",
                 body: data,
              })
              .then(response => response.json())
              .then(json => {
                 if(json.success) {
                    alert(json.data)
                    return
                 }
              })
              .catch(err => console.log(err))
        }

        pagar.addEventListener("submit", e=>{
            e.preventDefault();
            enviar()
        })

        traerProductosDelCarrito();

    </script>
</body>

</html>