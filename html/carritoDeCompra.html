<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
      </script>
   <link rel="stylesheet" href="../src/css/style.css">
   <title>Carrito de compra</title>
</head>

<body>
   <header class="py-3 border-bottom">
      <div class="container-fluid row align-items-center">
         <div class="dropdown col-12 col-lg-3 col-md-3">
            <a href="../html/index.html"
               class="d-flex align-items-center col-lg-4 mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
               <img src="../src/img/wallpaper/logo.png" alt="logo-Sao" class="d-block " width="100" height="40"
                  style="margin: 0 auto;">
            </a>
         </div>
         <div class="d-flex align-items-center d-grid gap-2 align-items-center col-12 col-lg-9 col-md-9"
            style="grid-template-columns: 95% 1fr;">
            <!-- Search -->
            <form class="w-100 me-3" role="search">
               <div class="input-group ">
                  <span class="input-group-text" id="basic-addon1" style="background-color: #fe6347;color: white;">
                     <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em"
                        width="1em" xmlns="http://www.w3.org/2000/svg">
                        <path
                           d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z">
                        </path>
                     </svg>
                  </span>
                  <input type="text" class="form-control input" placeholder="¿Que desea encontrar?"
                     aria-label="Username" aria-describedby="basic-addon1">
               </div>
            </form>

            <div class="flex-shrink-0 dropdown">
               <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle fs-2"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                     width="1em" xmlns="http://www.w3.org/2000/svg">
                     <path d="M3 4H21V6H3V4ZM9 11H21V13H9V11ZM3 18H21V20H3V18Z"></path>
                  </svg>
               </a>
               <ul class="dropdown-menu text-small shadow">
                  <li><a class="dropdown-item mb-2 py-2 " href="../html/cuenta.html">
                        <svg class="fs-3" stroke="currentColor" fill="currentColor" stroke-width="0"
                           viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                           <path
                              d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z">
                           </path>
                        </svg>
                        <span class="container">Mi cuenta</span>
                     </a></li>
                  <li><a class="dropdown-item mb-2 py-2 " href="../html/principalUser.html">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em"
                           width="1em" xmlns="http://www.w3.org/2000/svg">
                           <path
                              d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0zM1.5 8.5A.5.5 0 0 1 2 9v6h12V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5zm2 .5a.5.5 0 0 1 .5.5V13h8V9.5a.5.5 0 0 1 1 0V13a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V9.5a.5.5 0 0 1 .5-.5z">
                           </path>
                        </svg>
                        <span class="container">Tienda</span>
                     </a></li>
                  <li><a class="dropdown-item mb-2 py-2 " href="../html/listaDeseos.html">
                        <svg class="fs-3" stroke="currentColor" fill="currentColor" stroke-width="0"
                           viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                           <path
                              d="M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z">
                           </path>
                        </svg>
                        <span class="container">Lista de Deseos</span>
                     </a></li>
                  <li><a class="dropdown-item mb-2 py-2 " href="../html/carritoDeCompra.html">
                        <svg class="fs-3" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24"
                           stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em"
                           xmlns="http://www.w3.org/2000/svg">
                           <circle cx="8" cy="21" r="1"></circle>
                           <circle cx="19" cy="21" r="1"></circle>
                           <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12">
                           </path>
                        </svg>
                        <span class="container">Carrito</span>
                     </a></li>
                  <li><a class="dropdown-item mb-2 py-2 " href="../html/index.html">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512"
                           height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                           <path
                              d="M256 90c44.3 0 86 17.3 117.4 48.6C404.7 170 422 211.7 422 256s-17.3 86-48.6 117.4C342 404.7 300.3 422 256 422s-86-17.3-117.4-48.6C107.3 342 90 300.3 90 256s17.3-86 48.6-117.4C170 107.3 211.7 90 256 90m0-42C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z">
                           </path>
                           <path
                              d="M360 330.9L330.9 360 256 285.1 181.1 360 152 330.9l74.9-74.9-74.9-74.9 29.1-29.1 74.9 74.9 74.9-74.9 29.1 29.1-74.9 74.9z">
                           </path>
                        </svg>
                        <span class="container">Cerrar Sesión</span>
                     </a></li>
               </ul>
            </div>
         </div>
      </div>

   </header>

   <div class="carritoDeCompraFather container-fluid mb-5">
      <h5 class="container">
         Todos Los productos
      </h5>
      <div class="row carritoDeCompra" style="width:90%; max-width:1000px;margin: 0 auto;">
         <div class="p-3 col-12 col-lg-7 col-md-7 container-fluid" id="productosDelCarrito">
         </div>
         <div class="carritoPedido shadow-sm p-3 col-12 col-lg-5 col-md-5 container-fluid">
            <h4>Resumen Del Pedido</h4>
            <div class="row">
               <div class="col-6">
                  <p>Subtotal</p>
               </div>
               <div class="col-6 text-end">
                  <p id="total">$ 100.00 MXN</p>
               </div>
            </div>
            <div class="d-flex align-items-center">
               <a href="../datosDeCompra.html" style="display: block; width: 250px;margin: 0 auto;">
                  <button class="btn btn-primary" style="background-color: #FE6347; width: 100%;border: 0;">
                     Pagar ahora
                  </button>
               </a>
            </div>
         </div>
      </div>
   </div>

   <script>
      const componenteDelProducto = ({ id, name, id_product, description, price, imagen, quantity }) => {
         return `
            <div class="productCartSao shadow-sm mb-4 py-2 px-3 rounded-3 row" style="max-height: 250px;">
               <div class="col-4 productCartSaoImg"
                  style="background-image: url(${imagen});background-size: contain;background-repeat: no-repeat;">
               </div>
               <div class="col-5">
                  <h5>${name}</h5>
                  <p>${description}</p>
               </div>
               <div class="col-3 row" style="height: 50%;">
                  <span class="col-12 ">Costo: <b>$ ${price}</b></span>
                  <span class="col-12 mb-3">Total: <b> $ ${price * quantity}</b></span>
                     <span class="input-group-text col-4" style="cursor: pointer;">-</span>
                     <span class="input-group-text col-4 bg-white">${quantity}</span>
                     <span
                        class="input-group-text col-4" style="cursor: pointer;">+</span>
                     <button
                        class="btn btn-danger mt-3"
                        onClick="eliminarProducto('${id}','${id_product}','${name}')"
                     >Eliminar</button>
               </div>
            </div>
         `
      }
      const eliminarProducto = async (id, id_product, name) => {
         console.log(sessionStorage.getItem("iduser"))
         console.log(id_product)
         console.log(name)
         const data = new FormData();
         data.append("id_user", sessionStorage.getItem("iduser"));
         data.append("id_product", id_product)
         if (confirm("¿Esta seguro? de eliminar: " + name))
            await fetch("../php/cart/remove.php", {
               method: "POST",
               body: data
            })
               .then(res => res.json())
               .then(data => {
                  console.log(data)
                  alert(data.data)
                  if (data.success) window.location.reload()
               })
               .catch(err => console.log(err))
      }
      const traerCarrito = async () => {
         const data = new FormData()
         console.log(sessionStorage.getItem("iduser"))
         data.append("id_user", sessionStorage.getItem("iduser"))
         await fetch("../php/cart/get.php", {
            method: 'POST',
            body: data
         })
            .then(response => response.json())
            .then(response => {
               total = 0
               console.log(response.data)
               response.data.map(r => {
                  document.getElementById("productosDelCarrito").innerHTML += componenteDelProducto(r)
                  total += r.price * r.quantity
               });
               document.getElementById("total").innerHTML = `$ ${total} MXN`
               console.log(response.data)
            })
            .catch(e => console.log(e))
      }
      traerCarrito()
   </script>
</body>

</html>