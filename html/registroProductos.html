<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
        </script>
    <link rel="stylesheet" href="../src/css/style.css">
    <title>Página Principal</title>
</head>
<style>
    inputSaoSec {
        width: 100%;
        margin-bottom: 10px
    }

    .inputSaoSec label {
        display: block
    }

    .inputSaoSec label small {
        margin-left: 3px;
        color: red
    }

    .inputSaoSec input,
    .inputSaoSec select {
        display: block;
        width: 100%;
        padding: 5px 10px;
        border: 0;
        border-bottom: .6px solid #8f8f8f;
        outline: none;
        border-radius: 5px;
    }

    .inputSaoSec span {
        margin-top: 2px;
        display: block;
        text-align: end;
        font-size: 13px
    }

    .inputSaoSec.select select {
        margin-top: 5px;
        border: 0;
        box-shadow: 0px 0px 2px #aaa;
        border-radius: 10px;
        padding: 10px 10px
    }

    .buttonSao {
        margin-top: 20px;
        text-align: end
    }

    .buttonSao button {
        padding: 10px 20px;
        border-radius: 10px;
        background-color: #fe6347;
        color: white;
        border: 0;
        cursor: pointer
    }

    .buttonSao button:hover {
        background-color: #fe6347
    }

    .buttonSao button:active {
        background-color: #fe6347
    }

    .buttonSao button:focus {
        background-color: #fe6347
    }

    .buttonSao button:disabled {
        background-color: #fe6347
    }

    .buttonSao button:disabled:hover {
        background-color: #fe6347
    }

    .buttonSao button:disabled:active {
        background-color: #fe6347
    }

    .buttonSao button:disabled:focus {
        background-color: #fe6347
    }
</style>

<body>
    <header class="py-3 border-bottom">
        <div class="container-fluid row align-items-center">
        <div class="dropdown col-12 col-lg-3 col-md-3">
            <a href="../html/index.html"
                class="d-flex align-items-center col-lg-4 mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
                <img src="../src/img/wallpaper/logo.png" alt="logo-Sao" class="d-block " width="100" height="40"
                    style="margin: 0 auto;">
            </a>
        </div>

        <div class="d-flex align-items-center d-grid gap-2 align-items-center col-12 col-lg-9 col-md-9"
            style="grid-template-columns: 95% 1fr;">
            <!-- Search -->
            <form class="w-100 me-3" role="search">
                <div class="input-group ">
                    <span class="input-group-text" id="basic-addon1" style="background-color: #fe6347;color: white;">
                    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em"
                        width="1em" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z">
                        </path>
                    </svg>
                    </span>
                    <input type="text" class="form-control input" placeholder="¿Que desea encontrar?"
                    aria-label="Username" aria-describedby="basic-addon1">
                </div>
            </form>

            <div class="flex-shrink-0 dropdown">
                <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle fs-2"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                    width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 4H21V6H3V4ZM9 11H21V13H9V11ZM3 18H21V20H3V18Z"></path>
                    </svg>
                </a>
                <ul class="dropdown-menu text-small shadow">
                    <li><a class="dropdown-item mb-2 py-2 " href="../html/cuentaAdmin.html">
                        <svg class="fs-3" stroke="currentColor" fill="currentColor" stroke-width="0"
                            viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z">
                            </path>
                        </svg>
                        <span class="container">Mi cuenta</span>
                    </a></li>
                    <li><a class="dropdown-item mb-2 py-2 " href="../html/principalAdmin.html">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0zM1.5 8.5A.5.5 0 0 1 2 9v6h12V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5zm2 .5a.5.5 0 0 1 .5.5V13h8V9.5a.5.5 0 0 1 1 0V13a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V9.5a.5.5 0 0 1 .5-.5z"></path></svg>
                        <span class="container">Tienda</span>
                    </a></li>
                    <li><a class="dropdown-item mb-2 py-2 " href="../html/index.html">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                            <path d="M256 90c44.3 0 86 17.3 117.4 48.6C404.7 170 422 211.7 422 256s-17.3 86-48.6 117.4C342 404.7 300.3 422 256 422s-86-17.3-117.4-48.6C107.3 342 90 300.3 90 256s17.3-86 48.6-117.4C170 107.3 211.7 90 256 90m0-42C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"></path><path d="M360 330.9L330.9 360 256 285.1 181.1 360 152 330.9l74.9-74.9-74.9-74.9 29.1-29.1 74.9 74.9 74.9-74.9 29.1 29.1-74.9 74.9z"></path></svg>
                        <span class="container">Cerrar Sesión</span>
                    </a></li>
                </ul>
            </div>
        </div>
        </div>
    </header>

    <div class="container">
        <form class="shadow-sm py-4 px-2" method="post" id="form">
            <div class="container mx-auto">
                <h5>Agregar Producto</h5>
                <div class="container">
                    <div class="row">
                        <div class="mt-3 col-12 col-md-6">
                            <div class="inputSaoSec">
                                <label for="name">Imagen:<small>*</small>
                                </label>
                                <input type="file" name="InputImage" placeholder="" maxlength="50"
                                    value="">
                                <span>
                            </div> 
                        </div>
                        <div class="mt-3 col-12 col-md-6">
                            <div class="inputSaoSec select">
                                <label for="name">Categoria:</label>
                                <select name="selectCategory">
                                    <option value="2">electronica</option>
                                    <option value="3">moviliario</option>
                                    <option value="4">ofertas</option>
                                    <option value="1">papeleria</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-3 col-12 col-md-6">
                            <div class="inputSaoSec select">
                                <label for="name">Marca:</label>
                                <select name="selectBrand">
                                    <option value="1">marca</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-3 col-12 col-md-6">
                            <div class="inputSaoSec">
                                <label for="name">Nombre:<small>*</small>
                                </label>
                                <input type="text" minlength="0" name="InputName" placeholder="" maxlength="50"
                                    value="">
                                <span>

                            </div>
                        </div>
                        <div class="mt-3 col-12 col-md-6">
                            <div class="inputSaoSec">
                                <label for="name">Descripcion:<small>*</small>
                                </label>
                                <input type="text" minlength="0" name="InputDescription" placeholder="" maxlength="500"
                                    value="">
                                <span>
                            </div>
                        </div>
                        <div class="mt-3 col-12 col-md-6">
                            <div class="inputSaoSec">
                                <label for="name">Especificaciones:<small>*</small>
                                </label>
                                <input type="text" minlength="0" name="InputSpecification" placeholder="" maxlength="50"
                                    value="">
                                <span>

                            </div>
                        </div>
                        <div class="mt-3 col-12 col-md-6">
                            <div class="inputSaoSec">
                                <label for="name">Dimenciones:<small>*</small>
                                </label>
                                <input type="text" minlength="0" name="InputDimencions" placeholder="" maxlength="50"
                                    value="">
                                <span>

                            </div>
                        </div>
                        <div class="mt-3 col-12 col-md-6">
                            <div class="inputSaoSec">
                                <label for="name">Cantidad:<small>*</small>
                                </label>
                                <input type="number" minlength="0" name="InputQuantity" placeholder="1" maxlength="50"
                                    value="">
                                <span>

                            </div>
                        </div>
                        <div class="mt-3 col-12 col-md-6">
                            <div class="inputSaoSec">
                                <label for="name">Precio:<small>*</small>
                                </label>
                                <input type="text" minlength="0" name="InputPrice" placeholder="" maxlength="50"
                                    value="">
                                <span>

                            </div>
                        </div>
                        <div class="buttonSao">
                            <button type="submit" class="btn btn-danger rounded-4 ">Agregar Producto</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    </div>

    <script>
        let imagen=""
        const traerProducto = async (id) => {
            const data = new FormData()
            await fetch("http://localhost/SAO/php/products/getById.php?id_product=" + id, {
                method: 'POST',
                body: data,
            })
                .then(res => res.json())
                .then(data => {
                    const d = data.data[0]
                    if(!data.success) window.location.href="http://localhost/SAO/html/registroProductos.html"
                    const {
                        selectCategory,
                        selectBrand,
                        InputName,
                        InputDescription,
                        InputSpecification,
                        InputDimencions,
                        InputQuantity,
                        InputPrice,
                    } = document.getElementById("form")
                    selectCategory.innerHTML = `<option value="${d.id_category}">${d.category}</option>`
                    selectBrand.innerHTML = `<option value="${d.id_brand}">${d.brand}</option>`
                    InputName.value = d.name
                    InputDescription.value = d.description
                    InputSpecification.value = d.specifications
                    InputDimencions.value = d.dimensions
                    InputQuantity.value = d.stock
                    InputPrice.value = d.price
                    imagen = d.imagen
                })
                .catch(err => console.log(err))
        }
        if (window.location.search.split("=")[1]) {
            traerProducto(window.location.search.split("=")[1])
        }

        const agregarProducto = async (e) => {
            e.preventDefault()
            const form = e.target
            const {
                selectCategory,
                selectBrand,
                InputName,
                InputDescription,
                InputImage,
                InputSpecification,
                InputDimencions,
                InputQuantity,
                InputPrice,
            } = form

            console.log(InputImage.files[0])

            const data = new FormData()
            data.append("id", window.location.search.split("=")[1])
            data.append("id_category", selectCategory.value)
            data.append("id_brand", selectBrand.value)
            data.append("name", InputName.value)
            data.append("imagen", InputImage.files[0])
            data.append("description", InputDescription.value)
            data.append("specifications", InputSpecification.value)
            data.append("dimensions", InputDimencions.value)
            data.append("stock", InputQuantity.value)
            data.append("price", InputPrice.value)
            data.append("discount", "0.0")

            await fetch(window.location.search.split("=")[1] ? "../php/products/update.php" : "../php/products/add.php", {
                method: 'POST',
                body: data,
            })
                .then(res => res.text())
                .then(data => {
                    console.log(data)
                    if(data.success) window.location.href="http://localhost/SAO/html/cuentaAdmin.html"
                    alert(data.data)
                    // setBrands(data.data)
                })
                .catch(err => console.log(err))
        }
        window.addEventListener("submit", e => {
            agregarProducto(e)
        })
    </script>


</body>

</html>